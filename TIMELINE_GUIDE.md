# Timeline Feature Visual Guide

## How the Timeline Appears

### Collapsed State (Default)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PR Card                                                          â”‚
â”‚                                                                  â”‚
â”‚ Refreshed 8 times by 3 users    [â–¸ History] [Refresh] (5m ago) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Expanded State (After clicking History button)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PR Card                                                          â”‚
â”‚                                                                  â”‚
â”‚ Refreshed 8 times by 3 users    [â–¾ History] [Refresh] (5m ago) â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ACTIVITY TIMELINE                                                â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ ğŸ”„  PR refreshed by alice                                  â”‚   â”‚
â”‚ â”‚     by alice Â· 5 minutes ago                              â”‚   â”‚
â”‚ â”‚                                                            â”‚   â”‚
â”‚ â”‚ ğŸ“  Review status changed to approved                      â”‚   â”‚
â”‚ â”‚     1 hour ago                                             â”‚   â”‚
â”‚ â”‚                                                            â”‚   â”‚
â”‚ â”‚ âš™ï¸  Checks: 5 passed, 0 failed, 0 skipped                  â”‚   â”‚
â”‚ â”‚     2 hours ago                                            â”‚   â”‚
â”‚ â”‚                                                            â”‚   â”‚
â”‚ â”‚ ğŸ”„  PR refreshed by bob                                    â”‚   â”‚
â”‚ â”‚     by bob Â· 3 hours ago                                   â”‚   â”‚
â”‚ â”‚                                                            â”‚   â”‚
â”‚ â”‚ ğŸ‘  Review status changed to pending                       â”‚   â”‚
â”‚ â”‚     5 hours ago                                            â”‚   â”‚
â”‚ â”‚                                                            â”‚   â”‚
â”‚ â”‚ â•  PR #42 added to tracker                                â”‚   â”‚
â”‚ â”‚     2 days ago                                             â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                    (Scrollable if > 10 entries)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Action Types and Icons

| Icon | Action Type      | Description                           | Has Actor? |
|------|------------------|---------------------------------------|------------|
| ğŸ”„   | refresh          | User manually refreshed the PR        | Yes        |
| â•   | added            | PR was added to the tracker           | No         |
| ğŸ“   | state_change     | PR state changed (open/closed/merged) | Yes*       |
| ğŸ‘   | review_change    | Review status changed                 | Yes*       |
| âš™ï¸   | checks_change    | CI/CD checks status changed           | Yes*       |

*Actor is the user who triggered the refresh that detected the change.

## Key Features

1. **Compact Design**: Each entry is just 2-3 lines
2. **Color-Coded Icons**: Different colors for different action types
3. **Actor Attribution**: Shows who performed the action when applicable
4. **Relative Timestamps**: "5 minutes ago" instead of absolute dates
5. **Scrollable**: Max height with scroll for long histories
6. **On-Demand Loading**: Timeline loads only when expanded
7. **Toggle Behavior**: Click again to collapse

## Example Timeline Data

```json
[
  {
    "action_type": "refresh",
    "actor": "alice",
    "description": "PR refreshed by alice",
    "created_at": "2024-01-15T10:30:00Z"
  },
  {
    "action_type": "review_change",
    "actor": null,
    "description": "Review status changed to approved",
    "created_at": "2024-01-15T09:00:00Z"
  },
  {
    "action_type": "checks_change",
    "actor": null,
    "description": "Checks: 5 passed, 0 failed, 0 skipped",
    "created_at": "2024-01-15T08:00:00Z"
  },
  {
    "action_type": "added",
    "actor": null,
    "description": "PR #42 added to tracker",
    "created_at": "2024-01-14T15:45:00Z"
  }
]
```

## Implementation Details

### Frontend
- Uses Tailwind CSS for styling
- Timeline expands below PR card (not on the right side for better mobile support)
- Data fetched from `/api/pr-history/{pr_id}` endpoint
- Lazy loading: history only fetched when user clicks expand

### Backend
- `pr_history` table stores all actions
- Automatic change detection during refresh
- Tracks before/after state for changes
- Migration from old `refresh_history` table
